\documentclass[a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage[english]{babel}
\usepackage[super]{nth}
\usepackage{fancyhdr}
\usepackage{tabu}
\usepackage{multirow}
\usepackage{cite}
\usepackage{amsmath}


\DeclareGraphicsExtensions{.pdf,.png,.jpg,.eps}

\newcommand{\mytitle}{Zombie Apocalypse Report}
\newcommand*\mean[1]{\overline{#1}}

\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{Juraszek, Shiong, Signorini, Yang}
\fancyhead[R]{\mytitle}

\fancyfoot[C]{\thepage}

\title{\mytitle}
\author{Adam Juraszek \and Ryan Leong Wei Shiong \and Matthew Signorini \and Ziying Yang}

\begin{document}
\maketitle

\section{Introduction} % Ryan

Infectious diseases have been prevalent since the start of time.
Modelling the spread of these diseases can serve to find possible ways to stop or limit the spreading.
With the advancement of technology, computing power has increased tremendously, allowing these simulation models to be done on a greater scale.
In this project, we are to implement a Zombie Infection simulation, modeling the spread of the infection on a human population.
The entities in the simulation are split into three main categories, Humans, Infected and Zombies.
Infected are humans which will eventually turn into Zombies.

\subsection{Zombie description}

Since this is a, currently, fictional situation, the various different literatures provide different zombie characteristics.
For an instance, an article on the zombies of ``World War Z'', the zombies in the lore are slow moving until they sense humans around.
They will then move as fast, if not, faster than human running speed. \cite{guidetozombies}

In our model, the zombies are reanimated dead human bodies controlled by a viral infection, which is one of known types of zombies. \cite{survivingthedead}
A human becomes infected when it is bitten by a zombie.
The infection doesn't have any symptoms except for bite marks and short term memory loss.
The infection is latent and secretly spreads inside the body until it dominates.
The incubation period is 14 days on average, which is significantly longer than we are accustomed, however it has a medical support. \cite{mogk2011everything}
Later, during a weak moment (usually while sleeping) it causes death of the person and starts act on its own.

The zombies are naturally strongly atracted to humans to infect them and humans run away from zombies when they spot them.
The control of the body is poor and therefore the movement and motorics is slower and inaccurate.
The durability period of a reanimated dead body is shortend to about 3 years on average. \cite{zombiepedia}
Eventually a zombie falls and decomposes.

\subsection{Requirements}

\begin{enumerate}
\item In the first part of this project, the task was to simulate the human and zombie population on a 500 by 500 grid.
\item We had to take into account the birth and death rate of humans, keeping them close to the current demographics of the Northern Territory in Australia.
    This hold except for the population size which is reduced to one half. \cite{project}
\item We had to model zombies which are eager to chase and infect humans.
    We had to model zombie processes starting with infection and ending with decomposition.
\item With this model, we aim to find parameters which support coexisting of both populations of humans and zombies, and also don't contradict reality.
\end{enumerate}

\subsubsection{Stability requirement}

The last requirment makes the model hard as we cannot allow either population to drop too low and, as a consequence, to rise too high either.
If there were too little humans, the zombies couldn't infect anybody often enough to compensate their shorter lifespan.
On the other hand, if there are too many humans, the infection can spread very quickly and the zombies outnumber humans.
This is followed by steep decrease of both populations and finally becomes the former case with possibility of humans extinction.

\section{Model} % Adam

\subsection{Infection model}

\begin{figure*}[ht]
        \centering
        \includegraphics[width=\textwidth]{model}
        \caption{Infection model}
\end{figure*}

Since we don't suppose that there has not been found cure for infected (nor zombies) to become humans again, our model presumes only four possible stages and strictly one-way transitions.
This and non-existence of immunity is the main difference between our model and clasic SIR model and its variations.

An entity begins in state Human which represents a normal human being which was born, has a gender (is either male or female), and eventually dies.
If a human gets in contact with a zombie, it may become infected.
The probability of infection is unknown but for the purpose of our model it was set to $0.75\%$ for a human within 1 kilometer proximity to a zombie.
However small the probablility seems to be, it is quite acceptable concerning the smallest time and space units being 1 day and 1 kilometer.

Infected entity is basically a human which eventually becomes a zombie that means it can reproduce and die of natural death.
Infected entity is not a danger to the surrounding humans until it becomes a zombie.
Zombie is concidered death -- it is just a virus-driven moving body; therefore we say that a zombie eventually decomposes insead of it dies.
In our model, zombie doesn't have gender as it cannot reproduce nor its properties depend on gender of the human which it used to be.

When a human becomes infected, the length of the infection depends on the strength of the body fighting the zombie virus.
The transition happens with a certain probability that makes the average length of infection 14 days.

\subsubsection{Reproduction}

If two fertile living entities (no matter if humans infected) of different genders meet, they can make love and conceive a baby.
It takes approximately 9 months for a child to develop inside mother's womb before it is born. \cite{pregnancy}
As the zombies are of viral nature, we presume that the virus in infected mother's body is passed to unborn children.
The virus is not transmitted when an infected has an intercourse with a healthy human.

A female can become pregnant if she is not already pregnant, and she is in a fertile age (roughtly between 15 and 45 years) and her partner is a male in a fertile age (roughtly between 15 and 80).
More than one baby can be conceived during one intercourse -- our model supports that a female can expect up to three babies at once.
The probabilities of multiple births are in accordance with Hellin's law. \cite{hellinslaw}

\subsubsection{Age}

The model follows the Australian age distribution for both males and females.
When the simulation starts, the humans are divided into age classes based on their actual age.
Within an age class, the people are distributed uniformly.

Humans and infected are sorted into four age classes:
\begin{enumerate}
\item a child (0--15 years),
\item young (15--37.5 years),
\item middle aged (37.5--65 years),
\item elderly (65+).
\end{enumerate}

According to the latest scientific research, zombies live 3 to 5 years. \cite{zombiepedia}
Zombies are divided into two age classes:
\begin{enumerate}
\item young (0--1.5 years),
\item old (1.5+).
\end{enumerate}

Most of the properties of the entities are dependent on their gender and on age class rather than on their actual age.
The properties are:
\begin{itemize}
\item daily death rate -- the probability of a natural death per each day,
\item speed -- the probability of the entity to leave its current cell if it was its original intension.
\end{itemize}

Since the moving speed is a probability and the cell size is enormous, it only makes sense to compare the probabilities.
Females are slightly slower but still faster than zombies.
Speed of a young zombie equals to speed of an elderly human male.

Details about death probabilities are discusses later in the report.

\subsection{World representation}

The final simulated world will be a mesh of size $1000 \times 1500$ which correspond with size of Northern Territory. \cite{northernterritory}
Parts of the mesh are called cells.
On each cell, there may be at most one entity of any type; otherwise the cell is considered empty.
Adjacency of two entities means that the two entities are touching each other, sharing one side of their cells.
The simulated world has fixed boundaries, no entity can pass through them; this is often refered as to no-flux boundary condition.

For the purpose of this report, only part of the world is simulated.
The actual size of the mesh is $500 \times 500$ cells.

\subsubsection{Movement}

\begin{figure*}[ht]
    \centering
    \includegraphics[width=0.3\textwidth]{movement}
    \caption{Considered cells when planning movement}
\end{figure*}

\begin{figure*}[ht]
    \centering
    \begin{tabu} {| X[1.8,c,p] || X[1,c,p] | X[1,c,p] | X[1,c,p] | X[1,c,p] | X[1.2,c,p] |}
        \rowfont{\bfseries}
        \hline
        sees &
        Wall &
        Empty tile&
        Zombie &
        Same gender &
        Opposite gender \\
        \hline
        \hline
        \textbf{Living entity} & -- & + & -- & + & ++ \\
        \hline
        \textbf{Zombie} & -- & + & + & \multicolumn{2}{c|}{ ++ } \\
        \hline
    \end{tabu}
    \caption{Affinity to directed situations for each type}
\end{figure*}

All entities, including zombies, share the same movement planning model.
They differ mainly in preference where to go.

Each entity determines its optimal direction based on surrounding 12 cells as shown on the diagram.
The cells to which it can get within one move are marked with a fancy star; cells accessible within two moves are marked with a simple star.
When considering directions, the adjacent cells always have higher priority.

Each entity rates each of these cells based on their content.
The preference for direction is then calculated as a weighted sum of complex numbers corresponding to particular directions.
The values of preference were chosen to mimic expected bahaviour.
Better results could be achieved by a more sophisticated (genetic) algorithm or by a more thorough analysis.
The current estimates can be seen in the table below.
To the current preffered direction the potential direction of the last move is added, that simulates inertia of movement and as a result it makes the movement targeted.

After the optimal weighted direction is calculated, it is translated to a particular direction, or stay instruction if the absolute value is not sufficient.
The direction may randomly change clock-wise or counter-clock-wise simulating evading obstacles, which are not modeled in the world.
Then the cell in the resulting direction is tested whether it is free; if it is not, the clock-wise or cunter-clock-wise one is chosen.
In the worst case, the entity stays at its current tile.
The entity moves only if its speed (expressed as probability) is sufficient.

\subsection{Initialisation of the population}

\subsubsection{Age structure and death rate}

\begin{figure*}[ht]
    \centering
    \includegraphics[width=0.6\textwidth]{USGompertzCurve}
    \caption{Mortality rates for US in 2003}
\end{figure*}

According to the Australian age structure\cite{agestructure} and median of age 37.3 years \cite{demographicsaustralia}, initialized humans are divided into four age clasess.
Based on Gompertzâ€“Makeham law \cite{mortalitylaw} and mortality rates graph for US in 2003 (shown in the figure) the average probabilities of a human dying in these four age stages are approximately related as 
$$ \mean{P(\text{Elder Death})} = 10\: \mean{P(\text{Middle Age Death})} $$
$$ = 80\: \mean{P(\text{Young Death})} = 160\: \mean{P(\text{Child Death})} $$

As the Australian death rate \cite{absdeath} is
$$ \mean{P(\text{Australia Death})} = \frac{\text{people who died (in 2012)}}{\text{population size (in 2012)}} $$
$$ = \frac{147098}{23319400} = 0.63\%/\text{year} = 0.0017\%/\text{day} $$

The death rates for each age class can be calculated and expresses as shown in the table below.

\begin{figure*}[ht]
    \centering
    \begin{tabu} {| X[1.1,c,p] || X[0.7,c,p] | X[1.2,c,p] | X[1.1,c,p] | X[1,c,p] |}
        \rowfont{\bfseries}
        \hline
        Class Name &
        Age Range &
        Distribution &
        Average Death Rate (per day) &
        Death Rate (per day) \\
        \hline
        \hline
        \textbf{Child} & 0--15 & 18.2\% & \multirow{4}{*}{0.0017\%} & 0.00006\% \\
        \cline{1-3}\cline{5-5}
        \textbf{Young} & 15--37.5 & 31.8\% & & 0.00012\% \\
        \cline{1-3}\cline{5-5}
        \textbf{Middle Age} & 37.5--65 & 35.6\% & & 0.00096\% \\
        \cline{1-3}\cline{5-5}
        \textbf{Elderly} & 65+ & 14.4\% & & 0.0096\% \\
        \hline
    \end{tabu}
    \caption{Death rate of age classes}
\end{figure*}

\subsubsection{Birth rate}

The Australian birth rate is \cite{absbirth}:
$$ P(\text{Australian Birth}) = \frac{\text{baby births}}{\text{female population size}} = \frac{158988+150594}{23319400} = 1.33\% $$

To achieve this birth rate when the simulation is started, some of the initialial females should be pregnant at this stage.
If a female fertility period is from 15 to 45, then there are approximately 41.5\% fertile females.
Thus in the initialization stage, the pregnancy probability of females who are in the fertility period is: 
$$ P(\text{Pregnant Female in Fertility Period}) = \frac{\text{baby births}}{\text{female population size} \times 41.5\%} $$
$$ = \frac{158988+150594}{11659700 \times 41.5\%} = 2.655\% $$

Although we had access to birth rates, we didn't try to untilise them during the simulation because of the excessive difficulty of calculations.
Simple approach of counting probabilities of a male-female couples on a mesh do not work when the movement is targeted (as discussed earlier).
We also model fertilisation and pregnancy periods which naturally limit the baby procreation.

Our approach is to run the simulation of them model for several generations without presence of zombies, and by trials and errors find the right rate when the population size is stable or slightly increasing.
That way we got a probability of child being conceived each time a couple makes love equal to 0.0004, which is a number that doesn't make sense without context of the implemented model.
This is just a small price for much more realistic model of child birth.

\subsubsection{Sex ratio}

The birth ratio between males and females is 1.06. \cite{cia}
Thus the ratio of a child being a male of female is initialized a
$$ \text{Male Child} : \text{Female Child} = 0.5146 : 0.4854 $$

However, the ratio is different when the simulation starts.
The ratio in Australia is currently 1.01 and can be expressed as \cite{cia}
$$ \text{Male} : \text{Female} = 0.5025 : 0.4975 $$

\subsubsection{Population Density}

The population density in the Northern Territory prior to the zombie apocalypse is $0.17/\text{km}^2$. \cite{northernterritory}
When the viral infection starts, the authorities estimate that approximately half of the population will move from Australia to Sweden. \cite{project}
As the simulated mesh is $500 \times 500$, the initial number of simulated humans is
$$ 500 \cdot 500 \cdot \frac{0.17}{2} = 21250 $$

\section{Results}

TODO two images of state and a graph of populations' count.

\subsection{Demographics}

TODO demographics during the simulation.
Unfortunately we haven't implemented a function which prints information about individual people -- gender + age.

\subsection{Scaling}

\begin{figure*}[ht]
    \centering
    \begin{tabu} {| X[0.8,c,p] || X[1,c,p] | X[1,c,p] | X[1,c,p] |}
        \rowfont{\bfseries}
        \hline
        Threads &
        First attempt &
        Second attempt&
        Third attempt \\
        \hline
        \hline
        \textbf{1} & 180588.734000 & 180633.477000 & 180441.396000 \\
        \hline
        \textbf{2} & 94541.958000 & 95547.356000 & 94704.053000 \\
        \hline
        \textbf{4} & 49689.704000 & 50052.682000 & 50359.165000 \\
        \hline
        \textbf{8} & 25863.988000 & 26373.077000 & 26276.703000 \\
        \hline
        \textbf{16} & 14365.825000 & 14386.286000 & 14363.556000 \\
        \hline
        \textbf{32} & 10598.242000 & 10936.435000 & 10854.121000 \\
        \hline
        \textbf{64} & 14785.381000 & 14363.065000 & 14936.496000 \\
        \hline
    \end{tabu}
    \caption{Scaling depending on number of threads}
\end{figure*}


The model implemented in C using OpenMP can utilise several threads.
On Avoca the IBM Blue Gene/Q supercomputer, a single node provides 16 cores with 4 threads each.
Our model could utilise all 64 threads as most of the simulation does not need any thread synchronisation.

We run the model three times for 1000 iterations in order to ensure the influence of randomness does not make the results odd.
The results are in the table above, running times are in milliseconds.
We expect a perfect scaling up to 16 threads -- each of them will be assigned to a dedicated core.
Running with 32 cores still provides an improvement but not a significant one.
The drop of performace when running with 64 threads is either caused by the hardware architecture of the CPU or by using wrong random generators.
In our opinion it is not caused by locking parts of the world as there are still at least 7 columns for each thread (we lock only three of them).

\section{Recommendations}

Due to the large initialized population density and birth rate which is greater than average death rate, the human population will keep growing for a few years until the zombie population is large enough to meet and infect the human in significant speed.
In this case, the infected population is much greater than the amount of new birth human.
So the human population will drop quickly and the zombie population will be at its peak.
However a zombie can only live for 3 years normally.
If the human population is too low, zombie who has no birth income will die out soon.
In addition, the more human in initialization stage, the sooner the world collapses.

\subsection{Uncontrolled birth}

Theoretically the world should start with 21250 human.
The flow diagram below shows a testing result of the world starting with only 8000 human and 2 zombies.
After about only 63 years, zombies died out and human population dropped to 1809 people.

\begin{figure*}[pht]
    \centering
    \includegraphics[width=\textwidth]{uncontrolled_birth_8000}
    \caption{Uncontrolled birth with 8000 people and 2 zombies}
\end{figure*}

\subsection{Equal birth}

In order to make sure that the world lasts forever, we assume that the human can self-control the human birth rate to avoid dying out for being infected by a large amount of zombies.
At the beginning, humans and infected calculate their dead and infected who become zombies, and set the birth rate to maintan current population.
Some pregnant females will be infected and become zombies so the human population will decrease.
The result of the model is in the figure.

\begin{figure*}[pht]
    \centering
    \includegraphics[width=\textwidth]{equal_birth_8000}
    \caption{Equal birth with 8000 people and 2 zombies}
\end{figure*}

\subsection{Stable population}

When the human population is under 12000, at the time when zombie and human populations are almost equal, the human will be alerted that they should have more babies otherwise they will die out.
As the human birth has a gestation period and the zombie population will drop down sharply due to the low human population and meet chance, human population will grow remarkably after 10 years. 
This way the human and zombie population gets to equilibrium as shown in the figure which shows 273 years of simulation.

\begin{figure*}[pht]
    \centering
    \includegraphics[width=\textwidth]{stable}
    \caption{Stable populations of humans and zombies}
\end{figure*}

As another test diagram of ten times longer simulation shown below, the change of populations of human, infected and zombie will follow the law of 40 years cycle.
The population swings are fewer and fewer.
And they are quite stable after 465 years.

\subsection{Real Recommendation}

In order to get to the equilibrium, we can recommend people to behave normally until their population drops one half.
Then they should stop using birth control (which as a human-made resource won't be available anyway) and start reproducing like rabbits.
This strategy ensures that the populations of both, humans and zombies, gets stable over time.

\begin{figure*}[pht]
    \centering
    \includegraphics[width=\textwidth]{stable_1000000}
    \caption{2740 years long stable simulation}
\end{figure*}

\begingroup
\raggedright

\bibliographystyle{IEEEtran}
\bibliography{references}
\endgroup

\end{document}

% vim: ft=tex ts=4 sw=4 et
